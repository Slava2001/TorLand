<!DOCTYPE html>
<html data-theme="light">

<head>
    <meta charset="UTF-8" />
    <title>wdrop</title>
    <link rel="stylesheet" type="text/css" href="/css/main.css">
    <link rel="stylesheet" type="text/css" href="/css/pico/pico.min.css">
    <link rel="stylesheet" type="text/css" href="/css/flag-icon.min.css">
    <link rel="stylesheet" type="text/css" href="/css/siimple-icons.css">
    
    <link rel="stylesheet" type="text/css" href="/sections/TorLand/compiler/compiler.css">
    
    <script type="text/javascript" src="/js/jquerry-3.7.1.min.js"></script>
    <script type="text/javascript" src="/js/page.js"></script>
    <script type="text/javascript" src="/js/language.js"></script>
    <script type="text/javascript" src="/js/cookies.js"></script>

    <script type="text/javascript">
        window.onload = onLoad
    </script>
</head>

<body>
    <header id="header"></header>
    <section>
        <div class="container">
            <div class="grid">
                <div>
                    <div class="compile_ctl">
                        <div role="group">
                            <label for="bot_code">
                                <span lang="en">Bot code:</span>
                                <span lang="ru">Код бота:</span>
                            </label>
                            <input type="text" id="bot_code" name="bot_code" value="">
                        </div>
                        <select id="theme_selector" onchange="editor.setOption('theme', this.value)">
                            <option value="dracula">Dracula</option>
                            <option value="default">Default</option>
                            <option value="eclipse">Eclipse</option>
                            <option value="monokai">Monokai</option>
                            <option value="night">Night</option>
                        </select>
                        <div role="group">
                            <button id="compile_btn">
                                <span lang="en">Compile</span>
                                <span lang="ru">Компилировать</span>
                            </button><br>
                            <button id="decompile_btn" style="background-color: red;">
                                <span lang="en">Decompile</span>
                                <span lang="ru">Декомпилировать</span>
                            </button>
                        </div>
                    </div>
                    <div class="compile_textarea">
                        <div class="input_container">
                            <textarea id="input"></textarea>
                        </div>
                    </div>
                </div>
                <div>
                    <textarea disabled id="output"></textarea>
                </div>
            </div>
        </div>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/show-hint.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/show-hint.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/night.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/dracula.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/eclipse.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/monokai.css">
        <script src="./compiler.js"></script>
        <script type="module">
            import init, { compile, decompile } from './botc/botc.js';
            await init('./botc/botc_bg.wasm');
            async function run() {
                const input_code = editor.getValue();
                if (input_code.trim() == "") {
                    document.getElementById("output").value = "Empty imput";
                    return;
                }
                document.getElementById("output").value = compile(input_code);
            }
            document.getElementById("compile_btn").addEventListener('click', run);

            async function run_decompile() {
                const output_code = decompile(document.getElementById("bot_code").value)
                if (output_code.includes("Failed")) {
                    document.getElementById("output").value = output_code;
                } else {
                    editor.setValue(output_code);
                }
            }
            document.getElementById("decompile_btn").addEventListener('click', run_decompile);
        </script>
    </section>
    <footer id="footer"></footer>
</body>

</html>